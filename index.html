<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>AI Attribution Badges</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --ink: #0b1020;
      --panel: #0f172a;
      --muted: #94a3b8;
      --border: #1f2937;
      --card: rgba(255, 255, 255, 0.02);
      --accent: linear-gradient(135deg, #7B5CF9 0%, #E549FF 100%);
      --radius: 12px;
      --shadow: 0 18px 45px rgba(8, 12, 26, 0.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Manrope', 'Space Grotesk', 'Segoe UI', sans-serif;
      color: #e2e8f0;
      background: radial-gradient(circle at 20% 20%, rgba(124, 92, 249, 0.12), transparent 35%),
                  radial-gradient(circle at 80% 0%, rgba(229, 73, 255, 0.10), transparent 30%),
                  var(--ink);
    }
    a { color: #c084fc; }
    .shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 48px 20px 72px;
    }
    header {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      padding: 28px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    header h1 {
      margin: 0;
      font-size: 32px;
      letter-spacing: -0.5px;
    }
    header p {
      margin: 0;
      color: var(--muted);
      max-width: 720px;
      line-height: 1.5;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 22px;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .card h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }
    .muted { color: var(--muted); }
    ul { margin: 8px 0 0 18px; padding: 0; line-height: 1.5; }
    code, pre {
      font-family: "JetBrains Mono", "SFMono-Regular", Consolas, "Liberation Mono", monospace;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: #e5e7eb;
    }
    pre { padding: 14px; overflow-x: auto; }
    .badge-row {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 16px 14px;
      border-radius: 10px;
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25);
      text-align: center;
      margin: 2px;
    }
    .badge-row img {
      display: block;
      height: 20px;
      max-width: 100%;
    }
    .badge-title {
      font-weight: 600;
      margin: 0;
    }
    .badge-copy {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 14px;
    }
    .section-title {
      margin: 42px 0 12px;
      font-size: 22px;
      letter-spacing: -0.2px;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 12px 0;
    }
    label { font-weight: 600; font-size: 14px; display: block; margin-bottom: 6px; }
    select, textarea, input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: #e2e8f0;
      font-family: 'Manrope', 'Space Grotesk', 'Segoe UI', sans-serif;
    }
    select {
      appearance: none;
      background-image: linear-gradient(135deg, #7B5CF9 0%, #E549FF 100%);
      color: #0b0b15;
      font-weight: 700;
      border: none;
      padding-right: 42px;
      position: relative;
    }
    select option {
      color: #0b0b15;
      background: #eef2ff;
      font-weight: 600;
    }
    select:focus { outline: 2px solid #c084fc; outline-offset: 2px; }
    textarea { min-height: 120px; resize: vertical; }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      background: var(--accent);
      color: #0b0b15;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 10px 26px rgba(124, 92, 249, 0.35);
      transition: transform 0.08s ease, box-shadow 0.12s ease;
    }
    .btn:active { transform: translateY(1px); box-shadow: 0 6px 18px rgba(124, 92, 249, 0.25); }
    .preview {
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 10px;
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25);
    }
    .toast {
      font-size: 13px;
      color: #86efac;
      margin-left: 12px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .toast.show { opacity: 1; }
    @media (max-width: 640px) {
      header { padding: 20px; }
      header h1 { font-size: 26px; }
      .grid { grid-template-columns: 1fr; }
      .badge-row { align-items: flex-start; text-align: left; }
      .badge-row img { height: 24px; }
      pre { font-size: 13px; }
    }
    @media (max-width: 420px) {
      body { padding: 0; }
      .shell { padding: 28px 14px 56px; }
      pre { white-space: pre-wrap; word-break: break-word; }
    }
  </style>

  <!--
    ANALYTICS SETUP (Optional)
    The page tracks badge usage via trackEvent() function. To collect data:

    Option 1: Google Analytics
    Add before </head>:
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'GA_MEASUREMENT_ID');
    </script>

    Option 2: Plausible Analytics
    Add before </head>:
    <script defer data-domain="yourdomain.com" src="https://plausible.io/js/script.js"></script>

    Option 3: View local stats
    Open browser console and run: getBadgeStats()

    Events tracked:
    - badge_selected: When user picks a badge
    - format_changed: When user changes format (SVG, PNG, etc.)
    - code_copied: When user copies embed code
    - image_copied: When user copies badge image (PNG or SVG)
  -->

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8HVPN511EK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-8HVPN511EK');
  </script>
</head>
<body>
  <div class="shell">
    <header>
      <h1>AI Attribution Badges</h1>
      <p style="font-size: 18px; line-height: 1.5; margin: 12px 0 8px; color: #e2e8f0;">
        Show stakeholders and teammates exactly how AI was involved in your work—without awkward disclaimers or trust gaps.
      </p>
      <p class="muted" style="font-size: 15px;">
        Drop a badge in your email, deck, or brief. Takes 30 seconds. Free forever. Used by marketing teams to build transparency.
      </p>
    </header>

    <div style="text-align: center; margin: 28px 0 32px; padding: 20px; background: rgba(123, 92, 249, 0.05); border-radius: 12px; border: 1px solid rgba(123, 92, 249, 0.15);">
      <p class="muted" style="margin: 0 0 8px; font-size: 13px; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 600;">Total Badge Uses</p>
      <p id="usageCount" style="margin: 0; font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #7B5CF9, #E549FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1.2;">
        Loading...
      </p>
      <p class="muted" style="margin: 8px 0 0; font-size: 13px;">Badges copied and embedded across teams</p>
    </div>

    <section>
      <h2 class="section-title">The Problem</h2>
      <div class="card">
        <p class="muted" style="margin: 0 0 16px; font-size: 15px; line-height: 1.6;">
          You're using AI to draft campaign briefs, polish stakeholder emails, generate social copy, and speed up deck creation.
          But when colleagues and leadership receive your work, they're left wondering:
        </p>
        <div style="background: rgba(255,255,255,0.03); border-left: 3px solid #7B5CF9; padding: 14px 18px; margin: 16px 0; border-radius: 6px;">
          <p class="muted" style="margin: 0; font-style: italic;">
            "Did AI write this campaign brief? Was this researched or generated? Can I trust these insights?
            Should I verify this before presenting to leadership?"
          </p>
        </div>
        <p class="muted" style="margin: 16px 0 0; font-size: 15px; line-height: 1.6;">
          Marketing teams face unique pressure: stakeholder trust is everything. Without transparency, you're either writing paragraph-long
          disclaimers that kill your flow, or saying nothing and risking credibility. <strong>There's no quick, professional way to signal
          AI involvement</strong> that works across emails, decks, briefs, and campaign docs.
        </p>
      </div>
    </section>

    <section>
      <h2 class="section-title">The Solution</h2>
      <div class="grid">
        <div class="card">
          <h3>One Badge, Clear Signal</h3>
          <p class="muted">Pick a badge that matches your workflow. Drop it in your email footer, slide deck, or document header. Done.</p>
        </div>
        <div class="card">
          <h3>Process, Not Ownership</h3>
          <p class="muted">These badges describe how the work was created—not who owns it or who's responsible. Just transparency about the process.</p>
        </div>
        <div class="card">
          <h3>Instant Context</h3>
          <p class="muted">Recipients see the involvement level immediately. No follow-up questions. No trust gaps. Just clear, upfront communication.</p>
        </div>
      </div>
    </section>

    <section>
      <h2 class="section-title">Why Marketing Teams Use This</h2>
      <div class="grid">
        <div class="card">
          <h3>Build Stakeholder Trust</h3>
          <p class="muted">Show leadership and teammates exactly how campaigns were created. Transparency strengthens collaboration and sets clear expectations from day one.</p>
        </div>
        <div class="card">
          <h3>Speed Up Approvals</h3>
          <p class="muted">Stakeholders know what to review. "AI Drafted • Human Edited" means they'll fact-check. "Human Original" means trust the strategy.</p>
        </div>
        <div class="card">
          <h3>Professional Standard</h3>
          <p class="muted">Skip awkward disclaimers. A small badge in your email signature or deck footer signals transparency without breaking your brand voice.</p>
        </div>
      </div>
    </section>

    <section style="background: linear-gradient(135deg, rgba(123, 92, 249, 0.08), rgba(229, 73, 255, 0.06)); border: 1px solid rgba(123, 92, 249, 0.2); border-radius: 12px; padding: 32px 28px; margin-top: 32px;">
      <h2 style="margin: 0 0 16px; font-size: 24px;">Try It Now: 30-Second Setup</h2>
      <p class="muted" style="margin: 0 0 20px; font-size: 15px; line-height: 1.6;">
        Test a badge in your next email. Pick one below, copy the code, paste in your signature. That's it.
      </p>
      <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
        <a href="#embed" style="display: inline-flex; align-items: center; gap: 8px; text-decoration: none; border-radius: 10px; padding: 12px 20px; background: linear-gradient(135deg, #7B5CF9, #E549FF); color: #0b0b15; font-weight: 700; box-shadow: 0 10px 26px rgba(124, 92, 249, 0.35); transition: transform 0.08s ease;">
          Get Your First Badge →
        </a>
        <span class="muted" style="font-size: 14px;">No signup. No install. Free forever.</span>
      </div>
    </section>

    <section>
      <h2 class="section-title">How to Use</h2>
      <div class="grid" style="grid-template-columns: 1fr 1fr;">
        <div class="card">
          <h3 style="margin-bottom: 12px;">Quick Guidelines</h3>
          <ul style="margin: 0; padding-left: 18px; line-height: 1.7;">
            <li>One badge per artifact (email, deck, doc, FAQ)</li>
            <li>Choose the highest AI involvement that occurred</li>
            <li>When unsure, use <strong>Human–AI Co-Created</strong></li>
            <li>Place where people see it first</li>
            <li>Keep it attached when sharing</li>
          </ul>
        </div>
        <div class="card">
          <h3 style="margin-bottom: 12px;">Best Practices</h3>
          <ul style="margin: 0; padding-left: 18px; line-height: 1.7;">
            <li>Email: signature or footer</li>
            <li>Slides: title slide or footer</li>
            <li>Documents: cover page or header</li>
            <li>Always include alt text for accessibility</li>
            <li>Use SVG for web, PNG for email/slides</li>
          </ul>
        </div>
      </div>
    </section>

    <section>
      <h2 class="section-title">Badges</h2>
      <div class="grid">
        <div class="badge-row">
          <img src="badges/svg/human-original.svg?v=v2" alt="Human Original badge">
          <div>
            <p class="badge-title">Human Original</p>
            <p class="badge-copy">Created without AI assistance.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/human-original-ai-polished.svg?v=v2" alt="Human Original • AI Polished badge">
          <div>
            <p class="badge-title">Human Original • AI Polished</p>
            <p class="badge-copy">Human wrote it AI only refinished (grammar tone tightening).</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/human-written-ai-reviewed.svg?v=v2" alt="Human Written • AI Reviewed badge">
          <div>
            <p class="badge-title">Human Written • AI Reviewed</p>
            <p class="badge-copy">Human authored AI used for review or quality checks only.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/ai-suggested-human-approved.svg?v=v2" alt="AI Suggested • Human Approved badge">
          <div>
            <p class="badge-title">AI Suggested • Human Approved</p>
            <p class="badge-copy">AI proposed options human selected and lightly adjusted.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/human-curated.svg?v=v2" alt="Human Curated badge">
          <div>
            <p class="badge-title">Human Curated</p>
            <p class="badge-copy">Human selected or arranged AI outputs from multiple candidates.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/human-ai-co-created.svg?v=v2" alt="Human–AI Co-Created badge">
          <div>
            <p class="badge-title">Human–AI Co-Created</p>
            <p class="badge-copy">Human and AI collaborated iteratively shared authorship of ideas and wording.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/ai-drafted-human-edited.svg?v=v2" alt="AI Drafted • Human Edited badge">
          <div>
            <p class="badge-title">AI Drafted • Human Edited</p>
            <p class="badge-copy">AI first draft then substantive human rewriting or fact-checking.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/ai-drafted.svg?v=v2" alt="AI Drafted badge">
          <div>
            <p class="badge-title">AI Drafted</p>
            <p class="badge-copy">AI produced the first draft; minimal human edits.</p>
          </div>
        </div>
        <div class="badge-row">
          <img src="badges/svg/ai-generated.svg?v=v2" alt="AI Generated badge">
          <div>
            <p class="badge-title">AI Generated</p>
            <p class="badge-copy">AI produced the final artifact with no meaningful human edits.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="embed">
      <h2 class="section-title">Embed</h2>
      <div class="card" style="margin-bottom:18px;">
        <h3>Badge Picker &amp; Copy Helper</h3>
        <div class="form-row">
          <div>
            <label for="badgeSelect">Badge</label>
            <select id="badgeSelect"></select>
          </div>
          <div>
            <label for="formatSelect">Format</label>
            <select id="formatSelect">
              <option value="email">Email footer (SVG)</option>
              <option value="svg-md">Markdown (SVG)</option>
              <option value="svg-html">HTML IMG (SVG)</option>
              <option value="png1-html">HTML IMG (PNG 1x)</option>
              <option value="png2-html">HTML IMG (PNG 2x)</option>
              <option value="sprite">SVG Sprite &lt;use&gt;</option>
            </select>
          </div>
        </div>
        <div style="margin: 12px 0;">
          <label>Preview</label>
          <div class="preview">
            <img id="badgePreview" src="" alt="Badge preview" height="24">
          </div>
        </div>
        <div style="margin: 12px 0;">
          <label for="snippet">Code to paste</label>
          <textarea id="snippet" readonly></textarea>
        </div>
        <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="copyBtn" type="button">Copy</button>
          <button class="btn" id="copyImgBtn" type="button">Copy badge PNG</button>
          <button class="btn" id="copySvgBtn" type="button">Copy badge SVG</button>
          <span class="toast" id="toast">Copied</span>
        </div>
      </div>

    <div class="card" style="margin-bottom:18px;">
      <h3>How to add to Outlook (Windows desktop)</h3>
      <ol style="margin: 8px 0 0 18px; padding: 0; line-height: 1.5; color: var(--muted);">
        <li>Pick the badge and format above, choose “Email footer (SVG)”, then click Copy.</li>
        <li>In Outlook: File → Options → Mail → Signatures → Edit your signature.</li>
        <li>Place the cursor where you want the badge, choose Insert Picture, and paste the copied HTML (Ctrl+V).</li>
        <li>If Outlook strips HTML, paste into the signature editor’s HTML view (or Insert &gt; Picture from Clipboard).</li>
        <li>Click OK to save. Send yourself a test email to verify the badge renders and the alt text reads correctly when images are blocked.</li>
      </ol>
    </div>

      <!-- Additional examples removed to keep the embed section focused on the picker -->
    </section>
  </div>
</body>
<script>
  const ASSET_VERSION = "v4";
  const badges = [
    { slug: "human-original", label: "Human Original" },
    { slug: "human-original-ai-polished", label: "Human Original • AI Polished" },
    { slug: "human-written-ai-reviewed", label: "Human Written • AI Reviewed" },
    { slug: "ai-suggested-human-approved", label: "AI Suggested • Human Approved" },
    { slug: "human-curated", label: "Human Curated" },
    { slug: "human-ai-co-created", label: "Human–AI Co-Created" },
    { slug: "ai-drafted-human-edited", label: "AI Drafted • Human Edited" },
    { slug: "ai-drafted", label: "AI Drafted" },
    { slug: "ai-generated", label: "AI Generated" },
  ];

  // ============================================================================
  // USAGE TRACKING
  // Tracks badge selection, format changes, and copy actions to understand
  // which badges are most popular. Works with Google Analytics, Plausible,
  // or stores data locally. View stats in console: getBadgeStats()
  // ============================================================================

  function trackEvent(action, properties = {}) {
    // Google Analytics (gtag.js)
    if (typeof gtag !== 'undefined') {
      gtag('event', action, properties);
    }
    // Plausible Analytics
    if (typeof plausible !== 'undefined') {
      plausible(action, { props: properties });
    }
    // Console logging for development
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      console.log('[Analytics]', action, properties);
    }
    // Store locally for usage statistics
    try {
      const stats = JSON.parse(localStorage.getItem('badge-stats') || '{}');
      const key = `${action}_${properties.badge || 'unknown'}`;
      stats[key] = (stats[key] || 0) + 1;
      stats.lastTracked = new Date().toISOString();
      localStorage.setItem('badge-stats', JSON.stringify(stats));

      // Update counter for copy actions (in dev/demo mode)
      if ((action === 'code_copied' || action === 'image_copied') &&
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
        updateUsageCounter();
      }
    } catch (e) {
      // Silent fail if localStorage unavailable
    }
  }

  // Helper function to view collected badge usage stats (call from console)
  window.getBadgeStats = function() {
    try {
      const stats = JSON.parse(localStorage.getItem('badge-stats') || '{}');
      console.table(stats);
      return stats;
    } catch (e) {
      console.error('Failed to retrieve badge stats:', e);
      return {};
    }
  };

  // ============================================================================
  // USAGE COUNTER
  // Displays total badge uses with magnitude formatting (1k, 10k, 100k, 1M+)
  // Fetches live count from Google Analytics API via backend proxy
  // Falls back to TOTAL_BADGE_USES if API unavailable
  // ============================================================================

  const TOTAL_BADGE_USES = 45; // Fallback value if API unavailable
  const ANALYTICS_API_ENDPOINT = '/api/badge-count'; // Update with your API endpoint URL

  function formatMagnitude(num) {
    if (num < 1000) {
      return num.toString();
    } else if (num < 10000) {
      // 1k - 9.9k (show decimal for 1k-9k range)
      return (num / 1000).toFixed(1).replace('.0', '') + 'k';
    } else if (num < 1000000) {
      // 10k - 999k (no decimal)
      return Math.floor(num / 1000) + 'k';
    } else if (num < 10000000) {
      // 1M - 9.9M (show decimal)
      return (num / 1000000).toFixed(1).replace('.0', '') + 'M';
    } else if (num < 1000000000) {
      // 10M - 999M (no decimal)
      return Math.floor(num / 1000000) + 'M';
    } else {
      // 1B+ (show decimal)
      return (num / 1000000000).toFixed(1).replace('.0', '') + 'B';
    }
  }

  async function updateUsageCounter() {
    const counterEl = document.getElementById('usageCount');
    if (!counterEl) return;

    let totalUses = TOTAL_BADGE_USES; // Start with fallback

    // Try to fetch live count from Google Analytics API
    try {
      const response = await fetch(ANALYTICS_API_ENDPOINT, {
        method: 'GET',
        headers: { 'Accept': 'application/json' },
        cache: 'no-cache'
      });

      if (response.ok) {
        const data = await response.json();
        // API should return: { count: 12345, timestamp: "2024-01-31T..." }
        if (data.count && typeof data.count === 'number') {
          totalUses = data.count;
          console.log('[Analytics] Live count fetched:', totalUses);
        }
      } else {
        console.warn('[Analytics] API returned error:', response.status);
      }
    } catch (error) {
      console.warn('[Analytics] Failed to fetch live count, using fallback:', error.message);
    }

    // Optionally add local session count for demonstration in dev
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      try {
        const localStats = JSON.parse(localStorage.getItem('badge-stats') || '{}');
        const localCount = Object.keys(localStats)
          .filter(k => k.startsWith('code_copied_') || k.startsWith('image_copied_'))
          .reduce((sum, key) => sum + (localStats[key] || 0), 0);
        totalUses += localCount;
        console.log('[Analytics] Added local count:', localCount);
      } catch (e) {
        // Ignore localStorage errors
      }
    }

    counterEl.textContent = formatMagnitude(totalUses);
  }

  // Update counter on page load
  updateUsageCounter();

  const badgeSelect = document.getElementById("badgeSelect");
  const formatSelect = document.getElementById("formatSelect");
  const preview = document.getElementById("badgePreview");
  const snippet = document.getElementById("snippet");
  const toast = document.getElementById("toast");
  const copyBtn = document.getElementById("copyBtn");
  const copyImgBtn = document.getElementById("copyImgBtn");
  const copySvgBtn = document.getElementById("copySvgBtn");

  badges.forEach(b => {
    const opt = document.createElement("option");
    opt.value = b.slug;
    opt.textContent = b.label;
    badgeSelect.appendChild(opt);
  });

  function withV(path) {
    const url = new URL(path, window.location.href);
    url.searchParams.set("v", ASSET_VERSION);
    return url.href;
  }

  function buildSnippet(slug, label, fmt) {
    const svgUrl = withV(`badges/svg/${slug}.svg`);
    const png1 = withV(`badges/png/1x/${slug}.png`);
    const png2 = withV(`badges/png/2x/${slug}.png`);
    const sprite = withV(`sprites/sprite.svg#${slug}`);

    switch (fmt) {
      case "svg-md":
        return `![${label}](${svgUrl})`;
      case "svg-html":
        return `<img src="${svgUrl}" alt="${label}" height="20">`;
      case "png1-html":
        return `<img src="${png1}" alt="${label}" height="20">`;
      case "png2-html":
        return `<img src="${png2}" alt="${label}" height="40">`;
      case "email":
        return `<div style="font-family:'Segoe UI',Arial,sans-serif;font-size:13px;line-height:18px;">
  <strong>AI Disclosure:</strong><br>
  <img src="${svgUrl}" alt="${label}" height="20" style="vertical-align:middle;border:none;">
</div>`;
      case "sprite":
        return `<svg role="img" aria-label="${label}" height="20">
  <use href="${sprite}" />
</svg>`;
      default:
        return "";
    }
  }

  function updateUI() {
    const slug = badgeSelect.value;
    const fmt = formatSelect.value;
    const label = badges.find(b => b.slug === slug)?.label ?? "";

    // Preview prefers SVG for crispness
    preview.src = withV(`badges/svg/${slug}.svg`);
    preview.alt = label;

    snippet.value = buildSnippet(slug, label, fmt);
  }

  badgeSelect.addEventListener("change", () => {
    const slug = badgeSelect.value;
    const label = badges.find(b => b.slug === slug)?.label ?? "";
    trackEvent('badge_selected', { badge: slug, label: label });
    updateUI();
  });

  formatSelect.addEventListener("change", () => {
    const slug = badgeSelect.value;
    const fmt = formatSelect.value;
    trackEvent('format_changed', { badge: slug, format: fmt });
    updateUI();
  });

  copyBtn.addEventListener("click", async () => {
    const slug = badgeSelect.value;
    const fmt = formatSelect.value;
    const label = badges.find(b => b.slug === slug)?.label ?? "";

    try {
      await navigator.clipboard.writeText(snippet.value);
      trackEvent('code_copied', { badge: slug, label: label, format: fmt });
      toast.textContent = "Copied";
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1500);
    } catch (err) {
      toast.textContent = "Copy failed";
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2000);
    }
  });

  copyImgBtn.addEventListener("click", async () => {
    const slug = badgeSelect.value;
    const label = badges.find(b => b.slug === slug)?.label ?? "AI badge";
    const pngUrl = withV(`badges/png/2x/${slug}.png`);
    const fallbackOpen = () => {
      window.open(pngUrl, "_blank", "noopener");
      toast.textContent = "Clipboard blocked; opened image to copy manually";
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2200);
    };

    if (!isSecureContext || typeof ClipboardItem === "undefined" || !navigator.clipboard?.write) {
      fallbackOpen();
      return;
    }

    try {
      const res = await fetch(pngUrl);
      const blob = await res.blob();
      const item = new ClipboardItem({ [blob.type]: blob });
      await navigator.clipboard.write([item]);
      trackEvent('image_copied', { badge: slug, label: label, format: 'png' });
      toast.textContent = "Badge image copied";
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1500);
    } catch (err) {
      fallbackOpen();
    }
  });

  copySvgBtn.addEventListener("click", async () => {
    const slug = badgeSelect.value;
    const label = badges.find(b => b.slug === slug)?.label ?? "AI badge";
    const svgUrl = withV(`badges/svg/${slug}.svg`);
    const fallbackOpen = () => {
      window.open(svgUrl, "_blank", "noopener");
      toast.textContent = "Clipboard blocked; opened SVG to copy manually";
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2200);
    };

    if (!isSecureContext || typeof ClipboardItem === "undefined" || !navigator.clipboard?.write) {
      fallbackOpen();
      return;
    }

    try {
      const res = await fetch(svgUrl);
      const blob = await res.blob();
      const item = new ClipboardItem({ [blob.type]: blob });
      await navigator.clipboard.write([item]);
      trackEvent('image_copied', { badge: slug, label: label, format: 'svg' });
      toast.textContent = "Badge SVG copied";
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1500);
    } catch (err) {
      fallbackOpen();
    }
  });

  // Initialize defaults
  badgeSelect.value = badges[0].slug;
  updateUI();
</script>
</html>
